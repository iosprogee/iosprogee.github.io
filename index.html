<!DOCTYPE html>
<!-- 
  to run
/Applications/Google\ Chrome.app/Contents/MacOS/Google\ Chrome --args --disable-web-security --user-data-dir="/Users/artee/temp" file:///Users/artee/github.io/iosprogee/customerform.html

-->
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="minimum-scale=1, initial-scale=1, width=device-width"/>

  <title>No Title</title>

  <!-- Disable tap highlight on IE -->
  <meta name="msapplication-tap-highlight" content="no">

  <!-- Add to homescreen for Chrome on Android -->
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="application-name" content="VehicleLogger">
  <meta name="theme-color" content="#303F9F">

  <!-- Add to homescreen for Safari on iOS -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="FBDBQS">
  <meta name="apple-mobile-web-app-status-bar-style" content="#303F9F">

  <link rel="icon" href="/favicon.ico" type="image/x-icon">

  <!-- Tile icon for Win8 -->
  <meta name="msapplication-TileColor" content="#3372DF">
  <meta name="msapplication-navbutton-color" content="#303F9F">

  <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;400&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />


<style>
* {
  box-sizing: border-box;
  font-family: 'Open Sans', sans-serif;
  font-weight: 300;
  font-size: 1em;
}

input[type=text],input[type=tel],input[type=email], 
select, textarea {
 -webkit-transition: all 0.30s ease-in-out;
  -moz-transition: all 0.30s ease-in-out;
  -ms-transition: all 0.30s ease-in-out;
  -o-transition: all 0.30s ease-in-out;
  outline: none;

  font-size:0.9em;
  width: 100%;
  padding: 12px;
  border-radius: 4px;
  resize: vertical;
  border: 1px solid #dddddd;
}

select {
  max-height: calc(1.2em + 24px);
  height: calc(1.2em + 24px);
  background-color: white;
}

label {
  display: inline-block;
  font-size:1.1em;
  float: right;
  padding-top: 1vh;
  padding-bottom: 0;
  padding-right: 1vw;  
  color: royalblue;
}
button[type=button] {
  background-color: #0d47a1;
  color: white;
  padding: 2vh 2vw;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  float: right;
  width: 100%;
  font-size: 0.9em;
  letter-spacing: 0.4em;
}
button[type=button]:hover {
  background-color: #1976d2;
}
textarea{
  height:20vh;  
}
.iblue{
  background-color: #0d47a1;  
}
.fa{
  color: #0d47a1;  
}
.main {
  border-radius: 5px;
  background-color: #f2f2f2;
  padding: 2vh 2vw;
}

.col-left {
  float: left;
  width: 20%;
  margin-top:0px;
}

.col-right {
  float: left;
  width: 80%;
  margin-top: 6px;
}

/* Clear floats after the columns */
.row:after {
  content: "";
  display: table;
  clear: both;
}

@media screen and (max-width: 600px) {
  .col-left, .col-right, input[type=submit] {
    width:100%;
    margin-top: 0;
    margin-bottom:1vh;
  }
}
h2{
  font-weight:100;
  font-size: 1.2em;
  margin: 0 1vw;
  color: #0d47a1;
  display: inline;
}
.hide{display:none;}
.right{float:right; margin-left:1vw;}
.green{color:#004d40;}
.red{color:#ff1744;}
input:invalid { 
  //color: red;
  border: 1px solid red; 
}
textarea:focus, input:focus{
  box-shadow: 0 0 5px #0d47a1;
  border: 1px solid #0d47a1;
}
</style>
</head>
<body>
<!-- <h2>Responsive Form</h2>  -->

<div class="main">
  <div class="row">
    <h2>Customer Inquiry Form</h2>
    <span id="search" class="material-icons right">search</span> 
    <span id="check" class="material-icons right">done</span>
    <span id="clear" class="material-icons right">clear</span> 
 
  </div>  
  <form action="" autocomplete="off">
    <div id="id-row" class="row hide">
     <div class="col-left">
      <label for="id">
        <span class="material-icons">android</span>
         ID</label>
     </div>
     <div class="col-right">
      <input type="text" id="id" value="" placeholder='id' disabled>
     </div>
    </div>

    <div class="row">
     <div class="col-left">
      <label for="name">
        <span class="material-icons">account_box</span>
        Name</label>
     </div>
     <div class="col-right">
      <input type="text" id="name" placeholder="name" required>
     </div>
    </div>

    <div class="row">
     <div class="col-left">
      <label for="phone">
        <span class="material-icons">phone</span>
        Phone</label>
     </div>
     <div class="col-right">
       <input type="tel" id="phone" placeholder="phone" pattern="[0-9]{2,}-[0-9]{4}-[0-9]{4}" required>
     </div>
    </div>

    <div class="row">
     <div class="col-left">
      <label for="email">
        <span class="material-icons">alternate_email</span>
        Email</label>
      </div>
      <div class="col-right">
        <input type="email" id="email" placeholder='e-mail'>
      </div>
    </div>

    <div class="row hide">
     <div class="col-left">
       <label for="country">
        <span class="material-icons">outlined_flag</span>
        Country</label>
     </div>
     <div class="col-right">
       <select id="country" placeholder="country">
         <option value="" selected data-defaul>country</option>
         <option value="australia">Australia</option>        
         <option value="philippines">Philippines</option>        
         <option value="usa">USA</option>        
         <option value="canada">Canada</option>        
       </select>
     </div>
    </div>

    <div class="row">
      <div class="col-left">
       <label for="subject">
       <span class="material-icons">notes</span>
        Notes</label>
      </div>
      <div class="col-right">
       <textarea placeholder="remarks" id="remarks"></textarea>
      </div>
    </div>
    <div class="row">
     <div class="col-left">&nbsp;
     </div>
     <div class="col-right">
      <button id="submit" type="button">Submit</button>
     </div>
    </div>
  </form>
</div>



<!-- The core Firebase JS SDK is always required and must be listed first -->
<script src="https://www.gstatic.com/firebasejs/7.14.4/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.14.4/firebase-database.js"></script>

<!-- TODO: Add SDKs for Firebase products that you want to use
     https://firebase.google.com/docs/web/setup#available-libraries -->
<script src="https://www.gstatic.com/firebasejs/7.14.4/firebase-analytics.js"></script>

<script type="text/javascript">
  //Firebase configuration
  var firebaseConfig = {
    apiKey: "AIzaSyDMSdTQr8Y-FZWMgFMvb3tDyRf_y44KYis",
    authDomain: "fireupmyapp.firebaseapp.com",
    databaseURL: "https://fireupmyapp.firebaseio.com",
    projectId: "fireupmyapp",
    storageBucket: "fireupmyapp.appspot.com",
    messagingSenderId: "823746792317",
    appId: "1:823746792317:web:efbf29d7dc522a5a329a14",
    measurementId: "G-M08RXEKFFQ"
  };
  let fb=firebase;
  fb.initializeApp(firebaseConfig);
  fb.analytics();

  let d=document;
  d.title = "Customer Form"

  var l = d.querySelector("link[rel*='icon']") || d.createElement('link');
  l.type = 'image/x-icon'; l.rel = 'shortcut icon'; 
  l.href = 'https://iosprogee.github.io/favicon.ico';
  d.getElementsByTagName('head')[0].appendChild(l);

  window.addEventListener('load',()=>{ 
    //remove all labels
    const allLabels=d.getElementsByTagName("label");

    Object.keys(allLabels).forEach((item)=>{
      let firstGen=allLabels[item].childNodes;  //console.log(firstGen);
      for (var i = 0; i < firstGen.length; i++) {
        if(firstGen[i].nodeName='#text') firstGen[i].nodeValue='';
        //if(firstGen[i].nodeName='I') //nodeName for icon is I
      }
    });

    const allInputs=d.getElementsByTagName("input");
    /*
    Object.keys(allInputs).forEach((item)=>{
      console.log(allInputs[item].id);
    });    
    const allTA=d.getElementsByTagName("textarea");
    Object.keys(allTA).forEach((item)=>{
      console.log(allTA[item].id);
    }); 
    */

    //d.getElementById("saved").classList.remove("hide")
    //d.getElementById("saved").classList.add("hide")
    d.getElementById("name").focus()
    var idHide=true;

    d.getElementById('clear').addEventListener('click',(e)=>{
      d.getElementById('id').value = '';
      d.getElementById('name').value = '';
      d.getElementById('email').value = '';
      d.getElementById('phone').value = '';
      d.getElementById('remarks').value = '';
    });

    d.getElementById('check').addEventListener('click',(e)=>{
      if(idHide) d.getElementById("id-row").classList.remove('hide')
        else d.getElementById("id-row").classList.add('hide')
      idHide=!idHide;    
    });

    d.getElementById('search').addEventListener('click',(e)=>{
      if(d.getElementById('name').checkValidity()){
        fb.database().ref('customer').orderByChild("name")
        .equalTo(d.getElementById('name').value).once("value",snap => {

          d.getElementById('id').value = '';
          d.getElementById('name').value = '';
          d.getElementById('email').value = '';
          d.getElementById('phone').value = '';
          d.getElementById('remarks').value = '';
          
          if (snap.exists()){
            let record = Object.entries(snap.val())[0]
            console.log('key:',record[0]); console.log('name:',record[1].name)
            //for(var propertyName in record) console.log(propertyName);
            d.getElementById('id').value = record[0];
            d.getElementById('name').value = record[1].name;
            d.getElementById('email').value = record[1].email;
            d.getElementById('phone').value = record[1].phone;
            d.getElementById('remarks').value = record[1].remarks;
          }  
        });

      }
      e.preventDefault(); 
    })

    d.getElementById('submit').addEventListener('click',(e)=>{
      //if(d.getElementById('name').checkValidity() && d.getElementById('phone').checkValidity() && d.getElementById('email').checkValidity())  
      writeCustomerData();
      e.preventDefault(); 
    })

  }, false);  //eo window.addEventListener('load')

  function writeCustomerData() {
    var id = d.getElementById("id").value || fb.database().ref('customer').push().key;
    if(id) d.getElementById("id").value = id;
    console.log("ID",id);

    fb.database().ref('customer').orderByKey().equalTo(id).once("value",snapshot => {
      if (snapshot.exists()){
        const userData = snapshot.val();
        console.log("existing customer!", userData);
      } else{
        console.log("new customer!");
      }

      fb.database().ref('customer/' + id).update({
        "name": d.getElementById("name").value,
        "email": d.getElementById("email").value,
        "phone": d.getElementById("phone").value,
        "remarks": d.getElementById("remarks").value
      }).then((snap)=>{
        console.log('record saved:');      
      });

    });

/*

await fb.database().ref('customer').once("value").then(snap => {
  snap.forEach( (item)=> {
    var i = item; var c = item.val();
    console.log(i.key, c.name, c.email, c.phone)
  })  
})
*/    
  }






</script>
</body>
</html>

